name: CI for CeilingsApp

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Шаг 1: Клонируем репозиторий
    - name: Checkout code
      uses: actions/checkout@v2

    # Шаг 2: Проверка текущей директории (для отладки)
    - name: Check current directory
      run: pwd

    # Шаг 3: Устанавливаем Node.js
    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'  # Убедитесь, что версия Node.js соответствует требованиям проекта

    # Шаг 4: Устанавливаем зависимости
    - name: Install dependencies
      run: |
        npm install -g expo-cli  # Устанавливаем Expo CLI глобально
        npm install             # Устанавливаем зависимости проекта

    # Шаг 5: Логинимся в Expo (используя секреты для логина)
    - name: Log in to Expo
      run: expo login --username ${{ secrets.EXPO_USERNAME }} --password ${{ secrets.EXPO_PASSWORD }}

    # Шаг 6: Запуск сборки проекта для Android (или для iOS)
    - name: Build project
      run: expo build:android --non-interactive  # Или используйте expo build:ios для iOS

    # Шаг 7: Проверка состояния сборки (необязательно, но полезно для отладки)
    - name: Check build status
      run: |
        if [ -f build/status.txt ]; then
          cat build/status.txt
        else
          echo "No build status file found"
        fi
